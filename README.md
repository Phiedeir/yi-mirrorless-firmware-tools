# YI M1 Mirrorless Camera Firmware Tools 📸  
YI M1 微单相机固件工具 🛠️

[English](#english) | [中文](#中文说明)

---

## English 🇺🇸

Firmware tools / unpacker for the YI M1 mirrorless camera.

> This is a fork, just update something. 🔄

A firmware unpacker & repacker for YI M1 firmware files. Parses the section headers of a firmware file, extracts the sections into separate files, and splits and decompresses the firmware code sections.

### Requirements ⚙️

- [Node.js & npm](https://nodejs.org) (recommended: v8.10.0 LTS)

### Usage 🚀

1. `npm install`
2. Download [firmware](https://www.yitechnology.com/yi-m1-mirrorless-camera-firmware)
3. Run any of the supported commands:
   - `npm run unpack /path/to/firmware.bin` — Unpack the firmware file into separate (decompressed) files
   - `npm run repack /path/to/firmware.bin` — Repack unpacked data into a flashable firmware file (needs the `.unpack` metadata file generated by the `unpack` command). **⚠️ Warning: flashing generated files may damage your camera!**
   - `npm run flipregion /path/to/firmware.bin` — Change the region between CN and INT

The output will be a number of files (usually 4) named `firmware.bin.{sectionNumber}[.{sectionId}]`.

**⚠️ ATTENTION: the firmware decompression/compression is not yet 100% correct, do not attempt to flash a repacked firmware file or it may damage the camera!**

---

## 中文说明 🇨🇳

YI M1 微单相机固件工具 / 解包工具

> 本项目为分支，仅做部分更新。🔄

支持 YI M1 固件的解包与重打包，能解析固件文件的各个区块头部，将区块提取为独立文件，并分割与解压固件代码区块。

### 环境需求 ⚙️

- [Node.js 和 npm](https://nodejs.org)（推荐 v8.10.0 LTS）

### 使用方法 🚀

1. `npm install`
2. 下载[固件](https://www.yitechnology.com/yi-m1-mirrorless-camera-firmware)
3. 执行支持的命令：
   - `npm run unpack /path/to/firmware.bin` — 解包固件为独立（已解压）文件
   - `npm run repack /path/to/firmware.bin` — 将解包数据重新打包为可刷写的固件（需要 `unpack` 命令生成的 `.unpack` 元数据）。**⚠️警告：刷写生成的文件可能损坏相机！**
   - `npm run flipregion /path/to/firmware.bin` — 更改固件区域（CN/INT）

输出通常为 4 个名为 `firmware.bin.{sectionNumber}[.{sectionId}]` 的文件。

**⚠️注意：固件解压/压缩尚未完全正确，刷写重打包固件可能导致设备损坏！**

---

## Firmware analysis / 固件分析 🔬

Firmware files consist of 4 sections.  
固件文件包括 4 个区块：

| Section Number | Section Id | Size                  | Description (EN) | 描述（中文）        |
| -------------- | ---------- | --------------------- | ---------------- | ------------------- |
| 0              | *none*     | variable, ~7 MB       | Firmware code, contains compressed data sections | 固件代码，含压缩区块 |
| 1              | ND1        | variable, ~4 MB       | Memory image with resources (bitmaps, fonts, texts) | 资源区块（位图/字体/多语言文本） |
| 2              | IPL        | 128 kB, 0x20000 bytes | Bootloader (Initial Program Loader) | 引导加载程序 |
| 3              | PTBL       | 4 kB, 0x1000 bytes    | Partition table, unknown format | 分区表（未知格式） |

### Section headers / 区块头部 📝

Section headers are simple 256-byte strings. Examples:

```
LENGTH=7366656 C59Y1 VER=M1INT DVR=Ver1.37 SUM=937214718 ND1 IPL PTBL
ND1 LENGTH=4197888 C59Y1 VER=M1INT DVR=Ver1.37 SUM=299791776 OFFSET=23068672
IPL LENGTH=131072 C59Y1 VER=M1INT DVR=Ver1.37 SUM=5714438
PTBL LENGTH=4096  C59Y1 VER=M1INT SUM=5181
```

- `LENGTH`：区块体长度（字节）
- `SUM`：简单校验和
- `OFFSET`：内存偏移地址

### Hardware & Software Identification / 硬件与软件标识 🛠️

Run Unix `strings` utility against the decompressed firmware for interesting system/hardware strings.

#### Section 0 / 系统
- C:/XC_ODM/sdk/SDK_selfcheck/src/EV9x_DevEnv/btstack/bluesdk
- BCM4343A1_001.002.009.0043.0178 (Wifi)
- BCM4343WA1 37.4MHz Murata Type-1FJ BT4.1 OTP-BD-0043 (Bluetooth)
- Copyright (c) 2009-2010 Tokyo Electron Device Ltd
- Broadcom BCM.%s 802.11 Wireless Controller %s
- il0macaddr=00:90:4c:c5:12:38 (Broadcom MAC)
- bcm943430wlselgs_20150609__1FJ_lp2.txt
- Copyright 2009 Murata Manufacturing Co.,Ltd

#### Section 2 / IPL
- PureNAND IPL ev9x-v1.8t.r1864 (Mimasaka) [DEBUG BUILD] (Feb 10 2016 10:30:54)
- EV9XES1.0 / EV9XES2.0
- ARM926_1 / ARM926_2 (armv5te architecture)
- BCH2K124

### Camera Software / 相机软件 🎞️

#### Wifi / HTTP Server
When paired, the camera sets a Wifi password (8 digits) visible via Android app `logcat`.

---

## Next steps / 后续计划 🎯

- Identify partition table format and decode / 识别并解码分区表格式
- Disassemble first section / 反汇编第一个区块
- Change simple things (e.g. 500 shot limit), repack and upload / 修改固件（如拍摄张数限制），重打包并上传

---

## Other Cameras / 其它相机 🎥

The Fujifilm X-A10 camera uses the same [firmware format](http://www.fujifilm.com/support/digital_cameras/software/firmware/x/xa10/download.html) and can be unpacked with this tool.  
其他富士相机（如 Finepix S800）固件格式类似，但头部更短，暂不支持解包。

---

## FAQ 💡

**Q: What's the purpose of this tool? / 工具用途？**  
A: For firmware hacking, analysis, and region change. / 用于固件分析、破解和区域转换。

**Q: What can a potential firmware hack do? / 固件破解能做什么？**  
A:  
- Increase video bitrates / 提高视频码率
- Add 24p video modes / 增加 24p 视频模式
- Decrease JPEG compression / 降低 JPEG 压缩
- Change focus peaking color / 修改对焦峰值颜色
- Fix UX issues / 修复用户体验问题
  - e.g. disable full shutter press during video recording

**Q: How can I contribute? / 如何贡献？**  
A: Please open an issue, pull request, or email:  
mg@protyposis.net  
或联系 xiaolu34702@gmail.com 了解分支问题

**Q: Why JavaScript? / 为什么用 JavaScript？**  
A: Easier string manipulation, cross-platform via Node.js.

---
